<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>这里是云风青的blog</title>
    <link rel="stylesheet" href="./css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body>
    <!-- 博客配置 -->
    <script id="blog-settings" type="application/json">
        {"title":"云风青的技术博客","introduction":"欢迎来到云风青的blog！这里分享技术心得和学习笔记"}
    </script>

    <header>
        <h1 id="blog-title">技术博客</h1>
        <p class="header-desc" id="blog-intro">显示别名和修改时间的博客示例</p>
        
        <!-- 登录区域 -->
        <div class="login-container">
            <span class="username-display" id="username-display"></span>
            <div class="avatar-btn" id="avatar-btn">
                <img src="" alt="用户头像" class="avatar-img" id="avatar-img" style="display: none;">
                <i class="fa fa-user" id="default-avatar" style="color: #6b7280;"></i>
            </div>
            
            <div class="login-menu" id="login-menu">
                <div class="menu-item" id="login-item">
                    <i class="fa fa-sign-in"></i> 登录
                </div>
                <div class="menu-divider"></div>
                <div class="menu-item disabled" id="logout-item">
                    <i class="fa fa-sign-out"></i> 登出
                </div>
                <div class="menu-item disabled" id="refresh-item">
                    <i class="fa fa-refresh"></i> 刷新博客数据
                </div>
                <div class="menu-item disabled" id="api-status-item">
                    <i class="fa fa-bar-chart"></i> 查询API状态
                </div>
                
                <!-- 登录表单 -->
                <div id="login-form" style="display: none; padding: 0 1rem 1rem;">
                    <input type="password" class="token-input" id="github-token" placeholder="输入GitHub Token (ghp_xxx...)">
                    <button class="login-btn" id="submit-login">确认登录</button>
                </div>
            </div>
        </div>
    </header>

    <!-- 调试信息区域 -->
    <div id="debug-info" style="display: block; margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 4px; font-size: 0.9rem;">
        <h4 style="margin-top: 0; color: #dc3545;">调试信息：</h4>
        <pre id="debug-log"></pre>
    </div>

    <div class="tag-cloud">
        <h2>标签云</h2>
        <div class="tags-container" id="tags-container"></div>
    </div>

    <div class="loading" id="loading">正在加载博客内容...</div>
    <div id="blog-container" style="display: none;"></div>
    <div class="no-results" id="no-results" style="display: none;">没有找到匹配标签的文章</div>

    <!-- 引入JavaScript模块 -->
    <script type="module" src="./js/github-api.js"></script>
    <script type="module">
        import { 
            fetchFileCommitsViaGraphQL, 
            getUserInfo, 
            getRateLimit 
        } from './js/github-api.js';

        // -------------------------- 核心修改：从URL自动解析配置 --------------------------
        let config = {};
        try {
            // 1. 获取当前页面的URL主机名（如 "hugill-8121.github.io"）
            const hostname = window.location.hostname;
            logDebug(`当前页面主机名: ${hostname}`);

            // 2. 解析GitHub Pages域名格式：用户名.github.io
            const githubPagesRegex = /^([a-zA-Z0-9_-]+)\.github\.io$/;
            const match = hostname.match(githubPagesRegex);

            if (match && match.length >= 2) {
                // 提取用户名（owner）和仓库名（repo）
                const owner = match[1]; // 第一个分组：用户名（如 "hugill-8121"）
                const repo = `${owner}.github.io`; // 仓库名固定为 "用户名.github.io"
                const branch = 'main'; // GitHub Pages默认分支（通常为main或master，这里默认main）

                config = { owner, repo, branch };
                logDebug(`从URL解析配置成功: ${JSON.stringify(config)}`);
            } else {
                // 非GitHub Pages域名时，使用默认配置（可手动修改）
                config = {
                    owner: 'hugill-8121',
                    repo: 'hugill-8121.github.io',
                    branch: 'main'
                };
                logDebug(`非GitHub Pages域名，使用默认配置: ${JSON.stringify(config)}`);
            }
        } catch (err) {
            // 解析失败时，使用默认配置兜底
            config = {
                owner: 'hugill-8121',
                repo: 'hugill-8121.github.io',
                branch: 'main'
            };
            logDebug(`URL解析失败，使用默认配置: ${err.message}`);
        }
        // -----------------------------------------------------------------------------

        // 存储博客数据
        let allBlogs = [];
        let allTags = new Set();

        // DOM元素（保持不变）
        const blogContainer = document.getElementById('blog-container');
        const tagsContainer = document.getElementById('tags-container');
        const noResultsEl = document.getElementById('no-results');
        const loadingEl = document.getElementById('loading');
        const blogTitle = document.getElementById('blog-title');
        const blogIntro = document.getElementById('blog-intro');
        const debugInfo = document.getElementById('debug-info');
        const debugLog = document.getElementById('debug-log');

        // 登录相关DOM（保持不变）
        const avatarBtn = document.getElementById('avatar-btn');
        const loginMenu = document.getElementById('login-menu');
        const loginItem = document.getElementById('login-item');
        const logoutItem = document.getElementById('logout-item');
        const refreshItem = document.getElementById('refresh-item');
        const apiStatusItem = document.getElementById('api-status-item');
        const loginForm = document.getElementById('login-form');
        const githubTokenInput = document.getElementById('github-token');
        const submitLoginBtn = document.getElementById('submit-login');
        const avatarImg = document.getElementById('avatar-img');
        const defaultAvatar = document.getElementById('default-avatar');
        const usernameDisplay = document.getElementById('username-display');

        // API状态弹窗DOM（保持不变）
        const apiStatusModal = document.getElementById('api-status-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const modalUserLogin = document.getElementById('modal-user-login');
        const modalCoreRemaining = document.getElementById('modal-core-remaining');
        const modalCoreLimit = document.getElementById('modal-core-limit');
        const modalCoreReset = document.getElementById('modal-core-reset');
        const modalSearchRemaining = document.getElementById('modal-search-remaining');
        const modalSearchLimit = document.getElementById('modal-search-limit');
        const modalSearchReset = document.getElementById('modal-search-reset');
        const modalGraphqlRemaining = document.getElementById('modal-graphql-remaining');
        const modalGraphqlLimit = document.getElementById('modal-graphql-limit');

        // 初始化（保持不变）
        async function init() {
            loadBlogSettings();
            logDebug('初始化开始...');
            await loadBlogData();
            checkLoginStatus();
            bindEvents();
        }

        // 其他函数（loadBlogSettings、logDebug、loadBlogData等）保持不变...

        // 启动
        init();
    </script>
</body>
</html>